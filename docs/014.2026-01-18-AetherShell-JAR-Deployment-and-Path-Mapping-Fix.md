# AetherShell Developer Log 014

**Project:** AetherShell – Seamless Connectivity & UX Optimization  
**Version:** 2.0  
**Date:** 2026-01-18  
**Subject:** The JAR Deployment Wall: Solving Resource Mapping & Path Synchronicity

---

## 1. Executive Summary

Log 014 details the grueling transition from an IntelliJ-dependent development environment to a standalone, portable deployment via a compiled JAR.

The primary challenge was a **Resource Blackout** where the iOS app could successfully handshake with a session but failed to locate generated frames. This was resolved by enforcing **strict absolute pathing** and aligning Java static resource handlers with a shared physical directory used by the Python vision engine.

---

## 2. The Deployment Headache

Moving from an IDE to raw terminal execution revealed several invisible dependencies that broke the system:

- **Working Directory Drift**  
  In IntelliJ, the working directory defaults to the project root.  
  When running the JAR from a `.backend` subfolder, relative paths such as `../static` resolved to non-existent locations, causing persistent 404s for the iOS client.

- **Execution Race Condition**  
  The dashboard script executed faster than the Cloudflare tunnel could initialize.  
  This resulted in an “Empty Dashboard” failure where connection info was generated before the tunnel URL appeared in logs.

- **Python Environment Isolation**  
  The Python worker crashed due to scope errors (`NameError: BASE_DIR`) and directory mismatches, preventing the Flask bridge (port 5001) from ever waking up to receive VRAM data from the Java hub.

---

## 3. Technical Implementation Details

### A. Strict Absolute Pathing (Python)

To eliminate filesystem guesswork, `app.py` was refactored to calculate its base location dynamically using `os.path.abspath`.

This guarantees that regardless of launch location, the output directory is created in a predictable, shared path accessible by both Java and Python.

---

### B. Java WebMvc Resource Mapping

`WebConfig.java` was overhauled to bypass the internal classpath and serve assets directly from disk.

By using the `file:` protocol in `ResourceHandlerRegistry`, the Java hub was forced to serve images from the exact directory where the Python renderer writes them.

```java
// Logic to bridge the JAR to the physical disk
String userDir = System.getProperty("user.dir");

registry.addResourceHandler("/output/**")
        .addResourceLocations("file:" + userDir + "/static/output/");
```

---

### C. The “Wait-Loop” Handshake

A blocking wait-loop was implemented in the startup shell script.

The script now tails the log output and pauses execution until the string `trycloudflare.com` appears. This guarantees that `CONNECTION_INFO.txt` and the QR code are never generated before the tunnel is live.

---

## 4. Technical Performance Table

| Failure Point       | Root Cause                        | Final Solution                      |
| ------------------- | --------------------------------- | ----------------------------------- |
| Empty Dashboard     | Shell script race condition       | Grep-based while wait-loop          |
| Connection Refused  | Python `BASE_DIR` NameError       | Global absolute path definition     |
| iOS 404 (Frames)    | JAR encapsulation / path mismatch | Physical `file:` resource mapping   |
| Cross-script Sync   | Divergent static folders          | Unified `BASE_DIR` absolute pathing |
| Terminal Experience | Background process clutter        | `pkill` cleanup + automated launch  |

---

## 5. Key Technical Decisions

### Shared File System over Base64 Buffering

Frames are written to a shared physical directory instead of being serialized through JSON.
This reduces Java memory pressure and allows the iOS client to leverage native HTTP caching for smoother AR playback.

### Multi-Port Strategy (8080 / 8443)

Port 8080 remains dedicated to high-frequency NDS traffic, while port 8443 is reserved for Cloudflare-facing iOS clients.
This prevents telemetry noise from interfering with image delivery.

---

## 6. Summary

Log 014 marks the official **release-ready** state of the AetherShell backend for MacOS.
